tinymce.PluginManager.add("cloudinarybrowser", function (editor, url) {
	var optsToPass = ['modelName', 'listPath', 'itemName'];
	var params = optsToPass.map(function(o) {
		return o + '=' + editor.settings[o];
	}).join('&');
	var browseUrl = '/keystone/tiny-mce-plugin/cloudinarybrowser?' + params;
	//'modelName=listPath=' + editor.settings.listPath + '&itemName=' + editor.settings.itemName;
	editor.addButton("cloudinarybrowser", {
		//text: "Browse Cloudinary",
		icon: 'image',
		tooltip: 'Insert an image',
		onClick: function() {
			editor.windowManager.open({
				title: 'Browse Images',
				width: 640,
				height: 350,
				url: browseUrl,
				onSubmit: function(e) {
					editor.insertContent('Title: ' + e.data.title);
				},
				buttons: [{
					text: "Save",
					onclick: function() {
						console.log("//TODO: Save - upload, don't insert.");
					}
				}, {
					text: "Cancel",
					onclick: "close"
				}]
			})
		}
	});
});